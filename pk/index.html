<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚µãƒƒã‚«ãƒ¼PKã‚²ãƒ¼ãƒ  (ç–‘ä¼¼3Dãƒ»UIã‚¤ãƒ¡ãƒ¼ã‚¸)</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      font-family: Arial, sans-serif;
      color: #fff;
      text-align: center;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: #333;
      border: 1px solid #999;
    }
    /* UIè¦ç´ ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã«é‡ã­ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    #gameContainer {
      position: relative;
      width: 800px;
      margin: 20px auto; /* ä¸­å¤®å¯„ã› */
    }
    #gameCanvas {
      width: 800px;
      height: 600px;
      z-index: 1;
    }
    /* ç”»é¢ä¸­å¤®ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .center-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      font-weight: bold;
      color: #fff;
      pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ãªã©ã‚’é€é */
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    /* ã‚¹ã‚³ã‚¢ã‚„ã‚«ã‚¦ãƒ³ãƒˆãªã©ã®UI */
    .score-ui {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    }
    .count-ui {
      position: absolute;
      bottom: 20px;
      right: 20px;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
    }
    /* å³ä¸Šã®ãƒœã‚¿ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ */
    .top-buttons {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 10px;
    }
    .btn-icon {
      width: 40px;
      height: 40px;
      background-color: rgba(255,255,255,0.2);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }
    .btn-icon:hover {
      background-color: rgba(255,255,255,0.4);
    }
  </style>
</head>
<body>
  <h1>ã‚µãƒƒã‚«ãƒ¼PKã‚²ãƒ¼ãƒ  (ç–‘ä¼¼3Dã‚¤ãƒ¡ãƒ¼ã‚¸)</h1>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <!-- ä¸­å¤®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="center-message" id="centerMessage">SWIPE TO KICK THE BALL</div>

    <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
    <div class="score-ui" id="scoreUI">SCORE 0</div>
    <!-- ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º -->
    <div class="count-ui" id="countUI">0/15</div>

    <!-- å³ä¸Šãƒœã‚¿ãƒ³ç¾¤ -->
    <div class="top-buttons">
      <div class="btn-icon" onclick="togglePause()">â¸</div>  <!-- ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ -->
      <div class="btn-icon" onclick="toggleSound()">ğŸ”Š</div> <!-- éŸ³é‡ãƒœã‚¿ãƒ³(ä»®) -->
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const centerMessage = document.getElementById('centerMessage');
    const scoreUI = document.getElementById('scoreUI');
    const countUI = document.getElementById('countUI');

    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
    let paused = false;
    let score = 0;
    let shotCount = 0;
    const maxShots = 15;

    // ç–‘ä¼¼3Dç”¨ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
    const horizon = 50;          // ã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ï¼ˆä¸Šå´ï¼‰ã«è¿‘ã„ä½ç½®
    const minScale = 0.3;
    const maxScale = 1.2;

    function getScale(y) {
      // y: 0ï½600 (canvas.height)
      // horizon(50)ï½600 ã®é–“ã§ã‚¹ã‚±ãƒ¼ãƒ«è£œé–“
      if (y < horizon) y = horizon;
      return minScale + (maxScale - minScale) * ((y - horizon) / (canvas.height - horizon));
    }

    // èƒŒæ™¯ãƒ»ã‚´ãƒ¼ãƒ«ãƒãƒƒãƒˆãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æç”»
    function drawBackground() {
      // èƒŒæ™¯å…¨ä½“ã‚’å¡—ã‚Šã¤ã¶ã— (ã‚¹ã‚¿ã‚¸ã‚¢ãƒ é¢¨ã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‹ã‘ã‚‹ãªã©)
      const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
      grad.addColorStop(0, '#89CFF0'); // ç©ºè‰²
      grad.addColorStop(0.3, '#AAD751'); // è¦³å®¢å¸­ã£ã½ã„è‰²(ä»®)
      grad.addColorStop(1, '#228B22'); // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç·‘
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ã‚´ãƒ¼ãƒ«ãƒãƒƒãƒˆ (å¥¥ã®ç·š) ã‚’ç°¡æ˜“çš„ã«
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 2;
      // æ¨ªãƒ©ã‚¤ãƒ³
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(canvas.width * 0.3, horizon + i * 10);
        ctx.lineTo(canvas.width * 0.7, horizon + i * 10);
        ctx.stroke();
      }
      // ç¸¦ãƒ©ã‚¤ãƒ³
      for (let j = 0; j < 5; j++) {
        ctx.beginPath();
        ctx.moveTo(canvas.width * (0.3 + j * 0.1), horizon);
        ctx.lineTo(canvas.width * (0.3 + j * 0.1), horizon + 40);
        ctx.stroke();
      }
    }

    // ãƒœãƒ¼ãƒ«ç”»åƒã®èª­ã¿è¾¼ã¿
    const ballImage = new Image();
    ballImage.src = "ball.webp";

    // ãƒœãƒ¼ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    const ball = {
      x: canvas.width / 2,
      y: 500,
      radius: 40,   // å¤§ãã‚ã«ã—ã¦ã€æ‰‹å‰æ„Ÿã‚’æ¼”å‡º
      vx: 0,
      vy: 0,
      isShooting: false
    };

    // ã‚´ãƒ¼ãƒ«ã‚­ãƒ¼ãƒ‘ãƒ¼
    const goalkeeper = {
      x: canvas.width / 2,
      y: 100,       // ã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ã‚ˆã‚Šå°‘ã—æ‰‹å‰
      width: 50,
      height: 50,
      vx: 2
    };

    // ãƒœãƒ¼ãƒ«ã‚’æç”»ï¼ˆç”»åƒä½¿ç”¨ï¼‰
    function drawBall() {
      const scale = getScale(ball.y);
      const r = ball.radius * scale;

      // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚Œã°ç”»åƒã§æç”»ã€æœªèª­ã¿è¾¼ã¿ãªã‚‰ç™½ã„å††ã‚’è¡¨ç¤º
      if (ballImage.complete && ballImage.naturalWidth !== 0) {
        // ãƒœãƒ¼ãƒ«ã®ä¸­å¿ƒãŒ (ball.x, ball.y) ã«ãªã‚‹ã‚ˆã†ã«æç”»
        ctx.drawImage(ballImage, ball.x - r, ball.y - r, r * 2, r * 2);
      } else {
        // ç”»åƒãŒæœªèª­è¾¼ã®å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç™½ã„å††ï¼‰
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, r, 0, Math.PI * 2);
        ctx.fillStyle = '#ffffff';
        ctx.fill();
        ctx.strokeStyle = '#000000';
        ctx.stroke();
        ctx.closePath();
      }
    }

    // ã‚´ãƒ¼ãƒ«ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚’æç”» (ã“ã“ã§ã¯å››è§’å½¢+é ­éƒ¨ã®å††)
    function drawGoalkeeper() {
      const scale = getScale(goalkeeper.y);
      const w = goalkeeper.width * scale;
      const h = goalkeeper.height * scale;
      ctx.fillStyle = '#555';
      ctx.fillRect(goalkeeper.x - w/2, goalkeeper.y - h, w, h);
      // é ­éƒ¨ã‚’å††ã§æç”»
      ctx.beginPath();
      ctx.arc(goalkeeper.x, goalkeeper.y - h - (10*scale), 10*scale, 0, Math.PI*2);
      ctx.fillStyle = '#ccc';
      ctx.fill();
    }

    // ã‚´ãƒ¼ãƒ«ã‚­ãƒ¼ãƒ‘ãƒ¼ã®ç§»å‹• (ã‚´ãƒ¼ãƒ«ç¯„å›²å†…ã‚’å·¦å³ã«)
    function updateGoalkeeper() {
      goalkeeper.x += goalkeeper.vx;
      const leftLimit = canvas.width * 0.3;
      const rightLimit = canvas.width * 0.7;
      if (goalkeeper.x < leftLimit) {
        goalkeeper.x = leftLimit;
        goalkeeper.vx *= -1;
      }
      if (goalkeeper.x > rightLimit) {
        goalkeeper.x = rightLimit;
        goalkeeper.vx *= -1;
      }
    }

    // ãƒœãƒ¼ãƒ«ã®ç§»å‹•
    function updateBall() {
      if (!ball.isShooting) return;
      ball.x += ball.vx;
      ball.y += ball.vy;
      // æ‘©æ“¦
      ball.vx *= 0.98;
      ball.vy *= 0.98;
    }

    // ã‚´ãƒ¼ãƒ«åˆ¤å®š (åœ°å¹³ç·šã‚ˆã‚Šä¸Šã«è¡Œã£ãŸã‚‰ã‚´ãƒ¼ãƒ«åˆ¤å®š)
    function checkGoal() {
      if (ball.y < horizon + 20) {
        // ãƒœãƒ¼ãƒ«ãŒã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ä»˜è¿‘ã‚’é€šéã—ãŸã®ã§ã‚´ãƒ¼ãƒ«åˆ¤å®š
        // ã‚­ãƒ¼ãƒ‘ãƒ¼ã®ä½ç½®ã¨ãƒœãƒ¼ãƒ«ã®ä½ç½®ãŒé‡ãªã£ã¦ãªã‘ã‚Œã°ã‚´ãƒ¼ãƒ«
        const distGK = Math.hypot(ball.x - goalkeeper.x, ball.y - goalkeeper.y);
        const scaleGK = getScale(goalkeeper.y);
        const gkRadius = 25 * scaleGK; // ã‚´ãƒ¼ãƒ«ã‚­ãƒ¼ãƒ‘ãƒ¼ã®å½“ãŸã‚Šåˆ¤å®š(é©å½“)
        const scaleBall = getScale(ball.y);
        const ballRadius = ball.radius * scaleBall;

        if (distGK > gkRadius + ballRadius) {
          // ã‚´ãƒ¼ãƒ«æˆåŠŸ
          score++;
          alert("GOAL!!");
        } else {
          // ã‚»ãƒ¼ãƒ–
          alert("Saved by GK!");
        }
        resetBall();
      }
    }

    // ãƒœãƒ¼ãƒ«ã¨ã‚­ãƒ¼ãƒ‘ãƒ¼ã®è¡çªåˆ¤å®š (æ­£é¢ã§å½“ãŸã£ãŸå ´åˆã®è£œåŠ©)
    function checkCollision() {
      if (!ball.isShooting) return;
      const dist = Math.hypot(ball.x - goalkeeper.x, ball.y - goalkeeper.y);
      const scaleGK = getScale(goalkeeper.y);
      const gkRadius = 25 * scaleGK;
      const scaleBall = getScale(ball.y);
      const ballRadius = ball.radius * scaleBall;

      if (dist < gkRadius + ballRadius) {
        // ã‚­ãƒ¼ãƒ‘ãƒ¼ã«å½“ãŸã£ãŸ
        alert("Saved by GK!");
        resetBall();
      }
    }

    // ãƒœãƒ¼ãƒ«ãƒªã‚»ãƒƒãƒˆ
    function resetBall() {
      ball.x = canvas.width / 2;
      ball.y = 500;
      ball.vx = 0;
      ball.vy = 0;
      ball.isShooting = false;

      shotCount++;
      if (shotCount >= maxShots) {
        alert("ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: " + score);
        shotCount = 0;
        score = 0;
      }
      updateUI();
    }

    // UIæ›´æ–°
    function updateUI() {
      scoreUI.textContent = "SCORE " + score;
      countUI.textContent = shotCount + "/" + maxShots;
    }

    // ãƒã‚¦ã‚¹æ“ä½œ (ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚·ãƒ¥ãƒ¼ãƒˆæ–¹å‘ã¨ãƒ‘ãƒ¯ãƒ¼ã‚’æ±ºå®š)
    let isDragging = false;
    let dragStart = { x: 0, y: 0 };

    canvas.addEventListener('mousedown', (e) => {
      if (!ball.isShooting) {
        isDragging = true;
        dragStart.x = e.offsetX;
        dragStart.y = e.offsetY;
      }
    });
    canvas.addEventListener('mouseup', (e) => {
      if (isDragging) {
        isDragging = false;
        const dx = dragStart.x - e.offsetX;
        const dy = dragStart.y - e.offsetY;
        // ã‚·ãƒ¥ãƒ¼ãƒˆãƒ™ã‚¯ãƒˆãƒ«ï¼ˆä¸Šä¸‹å·¦å³ã‚’åè»¢ï¼‰
        ball.vx = -dx * 0.2;
        ball.vy = -dy * 0.2;
        ball.isShooting = true;
        centerMessage.style.display = "none";
      }
    });

    // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
    function gameLoop() {
      if (paused) {
        requestAnimationFrame(gameLoop);
        return;
      }

      drawBackground();
      updateGoalkeeper();
      updateBall();

      drawGoalkeeper();
      drawBall();

      if (ball.isShooting) {
        checkCollision(); // ã‚­ãƒ¼ãƒ‘ãƒ¼ã¨ã®è¡çª
        checkGoal();      // ã‚´ãƒ¼ãƒ«åˆ¤å®š
      }

      requestAnimationFrame(gameLoop);
    }

    // ãƒãƒ¼ã‚ºãƒœã‚¿ãƒ³
    function togglePause() {
      paused = !paused;
      if (!paused) {
        gameLoop();
      }
    }
    // éŸ³é‡ãƒœã‚¿ãƒ³ï¼ˆãƒ‡ãƒ¢ã§ã¯æ©Ÿèƒ½ã¯ãƒ€ãƒŸãƒ¼ï¼‰
    function toggleSound() {
      alert("ã‚µã‚¦ãƒ³ãƒ‰ã®ã‚ªãƒ³/ã‚ªãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æƒ³å®šã§ã™ã€‚");
    }

    // åˆæœŸåŒ–
    updateUI();
    gameLoop();
  </script>
</body>
</html>
